<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MockStorage.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">s0</a> &gt; <a href="index.source.html" class="el_package">edu.brown.cs.student.storage</a> &gt; <span class="el_source">MockStorage.java</span></div><h1>MockStorage.java</h1><pre class="source lang-java linenums">package edu.brown.cs.student.storage;

import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.concurrent.ExecutionException;

public class MockStorage implements IStorage {

  private Map&lt;String, Map&lt;String, Object&gt;&gt; rooms;
  private Map&lt;String, Map&lt;String, Object&gt;&gt; users;

<span class="nc" id="L15">  public MockStorage() {</span>
<span class="nc" id="L16">    this.rooms = new HashMap&lt;&gt;();</span>
<span class="nc" id="L17">    this.users = new HashMap&lt;&gt;();</span>
<span class="nc" id="L18">  }</span>

  // this should add an element to one of the instance variable maps. The collection_id is what
  // tells you which one it should go to. Then the doc ID is the string value in the map, and
  // the data becomes the object.
  @Override
  public void addDocument(String collection_id, String doc_id, Map&lt;String, Object&gt; data)
      throws IllegalArgumentException {
<span class="nc bnc" id="L26" title="All 6 branches missed.">    if (collection_id == null || doc_id == null || data == null) {</span>
<span class="nc" id="L27">      throw new IllegalArgumentException(&quot;Collection ID, document ID, and data cannot be null.&quot;);</span>
    }

<span class="nc" id="L30">    Map&lt;String, Map&lt;String, Object&gt;&gt; targetCollection = getCollectionById(collection_id);</span>

    // Add or overwrite the document
<span class="nc" id="L33">    targetCollection.put(doc_id, new HashMap&lt;&gt;(data));</span>
<span class="nc" id="L34">  }</span>

  @Override
  public void updateDocument(String collection_id, String doc_id, Map&lt;String, Object&gt; data)
      throws IllegalArgumentException {
<span class="nc bnc" id="L39" title="All 6 branches missed.">    if (collection_id == null || doc_id == null || data == null) {</span>
<span class="nc" id="L40">      throw new IllegalArgumentException(</span>
          &quot;updateDocument: collection_id, doc_id, or data cannot be null&quot;);
    }

<span class="nc" id="L44">    Map&lt;String, Map&lt;String, Object&gt;&gt; targetCollection = getCollectionById(collection_id);</span>

    // If the document exists, update the fields in the document
<span class="nc" id="L47">    Map&lt;String, Object&gt; existingDoc = targetCollection.get(doc_id);</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">    if (existingDoc != null) {</span>
      // Merge the existing document data with the new data
<span class="nc" id="L50">      mergeFields(existingDoc, data); // Adds or updates the fields in the existing document</span>
    } else {
      // If the document does not exist, create a new document if needed
<span class="nc" id="L53">      targetCollection.put(doc_id, new HashMap&lt;&gt;(data));</span>
    }
<span class="nc" id="L55">  }</span>

  @Override
  public List&lt;Map&lt;String, Object&gt;&gt; getCollection(String collection_id)
      throws InterruptedException, ExecutionException {
<span class="nc bnc" id="L60" title="All 2 branches missed.">    if (collection_id == null) {</span>
<span class="nc" id="L61">      throw new IllegalArgumentException(&quot;Collection ID cannot be null.&quot;);</span>
    }

<span class="nc" id="L64">    Map&lt;String, Map&lt;String, Object&gt;&gt; targetCollection = getCollectionById(collection_id);</span>

    // Return all documents in the collection as a list
<span class="nc" id="L67">    return new ArrayList&lt;&gt;(targetCollection.values());</span>
  }

  @Override
  public Map&lt;String, Object&gt; getDocument(String collection_id, String doc_id)
      throws InterruptedException, ExecutionException {
<span class="nc bnc" id="L73" title="All 4 branches missed.">    if (collection_id == null || doc_id == null) {</span>
<span class="nc" id="L74">      throw new IllegalArgumentException(&quot;Collection ID and document ID cannot be null.&quot;);</span>
    }

<span class="nc" id="L77">    Map&lt;String, Map&lt;String, Object&gt;&gt; targetCollection = getCollectionById(collection_id);</span>

<span class="nc" id="L79">    return targetCollection.get(doc_id); // could be null btw</span>
  }

  @Override
  public void deleteDocument(String collectionID, String docID)
      throws InterruptedException, ExecutionException {
<span class="nc bnc" id="L85" title="All 4 branches missed.">    if (collectionID == null || docID == null) {</span>
<span class="nc" id="L86">      throw new IllegalArgumentException(&quot;deleteDocument: collectionID and docID cannot be null&quot;);</span>
    }

<span class="nc" id="L89">    Map&lt;String, Map&lt;String, Object&gt;&gt; targetCollection = getCollectionById(collectionID);</span>

    // Check if the document exists in the collection
<span class="nc bnc" id="L92" title="All 2 branches missed.">    if (targetCollection.containsKey(docID)) {</span>
      // Remove the document from the collection
<span class="nc" id="L94">      targetCollection.remove(docID);</span>
<span class="nc" id="L95">      System.out.println(</span>
          &quot;Document with ID &quot; + docID + &quot; has been deleted from collection: &quot; + collectionID);
    } else {
      // If the document does not exist, throw an exception
<span class="nc" id="L99">      throw new IllegalArgumentException(</span>
          &quot;Document with ID &quot; + docID + &quot; does not exist in collection: &quot; + collectionID);
    }
<span class="nc" id="L102">  }</span>

  @Override
  public long getDocumentCount(String collectionID)
      throws InterruptedException, ExecutionException {
<span class="nc" id="L107">    return 0;</span>
  }

  @Override
  public List&lt;Map&lt;String, Object&gt;&gt; getProblems(String difficulty, int number)
      throws InterruptedException, ExecutionException, IOException {
<span class="nc" id="L113">    return null;</span>
  }

  @Override
  public Map&lt;String, Object&gt; getProblem(String problemID)
      throws InterruptedException, ExecutionException, IOException {
<span class="nc" id="L119">    return null;</span>
  }

  @Override
  public List&lt;Map&lt;String, Object&gt;&gt; sortCollection(String collectionID, String field)
      throws InterruptedException, ExecutionException, IOException {
<span class="nc" id="L125">    List&lt;Map&lt;String, Object&gt;&gt; collection = this.getCollection(collectionID);</span>

    // Sort the collection based on the specified field
<span class="nc" id="L128">    collection.sort(</span>
        (map1, map2) -&gt; {
<span class="nc" id="L130">          Comparable&lt;Object&gt; value1 = (Comparable&lt;Object&gt;) map1.get(field);</span>
<span class="nc" id="L131">          Comparable&lt;Object&gt; value2 = (Comparable&lt;Object&gt;) map2.get(field);</span>

<span class="nc bnc" id="L133" title="All 4 branches missed.">          if (value1 == null || value2 == null) {</span>
<span class="nc" id="L134">            throw new IllegalArgumentException(&quot;Field value is missing or null.&quot;);</span>
          }

<span class="nc" id="L137">          return value1.compareTo(value2) * -1;</span>
        });

<span class="nc" id="L140">    return collection;</span>
  }

  // helper to make getting collection easier
  private Map&lt;String, Map&lt;String, Object&gt;&gt; getCollectionById(String collection_id)
      throws IllegalArgumentException {
<span class="nc bnc" id="L146" title="All 3 branches missed.">    switch (collection_id) {</span>
      case &quot;Rooms&quot;:
<span class="nc" id="L148">        return this.rooms;</span>
      case &quot;Users&quot;:
<span class="nc" id="L150">        return this.users;</span>
      default:
<span class="nc" id="L152">        throw new IllegalArgumentException(&quot;Invalid collection ID: &quot; + collection_id);</span>
    }
  }

  /**
   * Helper for update Recursively merges the fields from the source map into the target map. -
   * Overwrites primitive values. - Updates nested maps instead of replacing them entirely.
   *
   * @param target The target map to update.
   * @param source The source map with new data.
   */
  private void mergeFields(Map&lt;String, Object&gt; target, Map&lt;String, Object&gt; source) {
<span class="nc bnc" id="L164" title="All 2 branches missed.">    for (Map.Entry&lt;String, Object&gt; entry : source.entrySet()) {</span>
<span class="nc" id="L165">      String key = entry.getKey();</span>
<span class="nc" id="L166">      Object value = entry.getValue();</span>

<span class="nc bnc" id="L168" title="All 4 branches missed.">      if (value instanceof Map &amp;&amp; target.get(key) instanceof Map) {</span>
        // If both target and source have maps at this key, merge them
<span class="nc" id="L170">        Map&lt;String, Object&gt; targetNestedMap = (Map&lt;String, Object&gt;) target.get(key);</span>
<span class="nc" id="L171">        Map&lt;String, Object&gt; sourceNestedMap = (Map&lt;String, Object&gt;) value;</span>
<span class="nc" id="L172">        mergeFields(targetNestedMap, sourceNestedMap);</span>
<span class="nc" id="L173">      } else {</span>
        // Otherwise, overwrite the value in the target map
<span class="nc" id="L175">        target.put(key, value);</span>
      }
<span class="nc" id="L177">    }</span>
<span class="nc" id="L178">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>